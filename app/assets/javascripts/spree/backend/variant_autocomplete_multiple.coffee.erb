formatVariantResult = (variant) ->
#  variant.image = variant.images[0].mini_url  if variant["images"][0] isnt `undefined` and variant["images"][0].mini_url isnt `undefined`
  variantTemplate variant: variant

$.fn.variantAutocompleteMultiple = (searchOptions = {}) ->
  @select2
    placeholder: Spree.translations.variant_placeholder
#    minimumInputLength: 3
    multiple: true
    closeOnSelect:false
    initSelection: (element, callback) ->
      Spree.ajax
        url: Spree.routes.variants_api
        data: { q: {
          id_in: element.val().split(',')
          }
        }
        success: (data) ->
          callback(data['variants'])
    data: window.variants
#    ajax:
#      url: Spree.routes.variants_api
#      datatype: "json"
#      quietMillis: 500
#      params: { "headers": { "X-Spree-Token": Spree.api_key } }
#      data: (term, page) =>
#        searchData =
#          q:
#            product_name_or_sku_cont: term
#          token: Spree.api_key
#        _.extend(searchData, searchOptions)
#
#      results: (data, page) ->
#        window.variants = data["variants"]
#        results: data["variants"]

    formatResult: formatVariantResult
    formatSelection: (variant) ->
      if !!variant.options_text
        variant.name + " (#{variant.options_text})"
      else
        variant.name
